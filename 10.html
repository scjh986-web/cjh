<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>视频播放</title>
    <style>
        :root {
            --accent: #00f2ff;
            --apple-ease: cubic-bezier(0.2, 0, 0, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background: #080808;
            color: #fff;
            font-family: -apple-system, "PingFang SC", sans-serif;
            height: 100vh;
            display: flex; flex-direction: column; overflow: hidden;
            -webkit-font-smoothing: antialiased;
            transition: background 0.8s var(--apple-ease);
        }

        body.is-immersive { background: #000; }

        .player-frame { padding: 16px; flex-shrink: 0; }
        .player-stage {
            position: relative; width: 100%; aspect-ratio: 16 / 9;
            background: #000; border-radius: 20px;
            overflow: hidden; box-shadow: 0 40px 100px rgba(0,0,0,0.8);
        }
        video { width: 100%; height: 100%; object-fit: contain; }

        /* --- 智能加载层优化 --- */
        .loading-overlay {
            position: absolute; inset: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            z-index: 15; opacity: 0; pointer-events: none;
            transition: opacity 0.5s var(--apple-ease);
        }
        .is-loading .loading-overlay { opacity: 1; pointer-events: auto; }

        .loading-text { 
            font-size: 12px; letter-spacing: 3px; color: #b0b0b0; 
            margin-bottom: 20px;
            animation: pulse-text 2s infinite ease-in-out; 
        }

        /* 立即播放按钮：初始隐藏 */
        .force-play-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: #888; padding: 10px 24px; border-radius: 12px;
            font-size: 11px; letter-spacing: 2px;
            cursor: pointer; opacity: 0; transform: translateY(10px);
            transition: all 0.6s var(--apple-ease);
            pointer-events: none;
        }
        .force-play-btn.visible {
            opacity: 1; transform: translateY(0); pointer-events: auto;
        }
        .force-play-btn:active { background: rgba(255,255,255,0.15); transform: scale(0.95); }

        @keyframes pulse-text { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }

        /* 暂停反馈层 */
        .stage-overlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0); pointer-events: none; transition: 0.5s; z-index: 10; }
        .pause-line { width: 1.5px; height: 18px; background: #fff; border-radius: 1px; opacity: 0; transform: scale(1.4); transition: 0.5s; }
        .video-paused .pause-line { opacity: 0.8; transform: scale(1); }
        .video-paused .stage-overlay { background: rgba(0,0,0,0.4); backdrop-filter: blur(10px); }

        /* 全屏按钮：2秒逻辑 */
        .fs-trigger {
            position: absolute; bottom: 15px; right: 15px;
            background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1);
            color: #ccc; padding: 10px 20px; border-radius: 12px;
            font-size: 10px; letter-spacing: 1px; backdrop-filter: blur(15px);
            opacity: 0; pointer-events: none;
            transition: opacity 0.5s var(--apple-ease), transform 0.5s var(--apple-ease);
            z-index: 20; transform: translateY(8px);
        }
        .fs-visible { opacity: 1; pointer-events: auto; transform: translateY(0); }

        .action-bar { display: flex; justify-content: space-between; align-items: center; padding: 20px 30px; }
        .action-bar h2 { font-size: 10px; color: #333; letter-spacing: 4px; }
        .imm-btn { position: relative; background: #151515; border: 1px solid rgba(255,255,255,0.05); color: #777; padding: 12px 28px; border-radius: 14px; font-size: 12px; overflow: hidden; transition: all 0.6s var(--apple-ease); cursor: pointer; z-index: 1; }
        .imm-btn::before { content: ''; position: absolute; inset: 0; background: linear-gradient(180deg, #1a1a1a 0%, #b0b0b0 100%); opacity: 0; transition: 0.6s var(--apple-ease); z-index: -1; }
        .imm-btn.active { color: #111; border-color: rgba(255,255,255,0.2); }
        .imm-btn.active::before { opacity: 0.9; }

        .scroller { flex: 1; overflow-y: auto; padding: 10px 20px 40px; }
        .scroller::-webkit-scrollbar { display: none; }
        .card { position: relative; padding: 26px 30px; background: rgba(255,255,255,0.01); border-radius: 20px; margin-bottom: 16px; transition: 0.7s var(--apple-ease); border: 1px solid transparent; cursor: pointer; overflow: hidden; opacity: 0.4; }
        .card.active { opacity: 1; background: rgba(255, 255, 255, 0.03); transform: translateY(-4px) scale(1.02); box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
        .card::after { content: ''; position: absolute; left: 0; top: 35%; width: 2px; height: 30%; background: var(--accent); border-radius: 0 4px 4px 0; transform: scaleY(0); transition: transform 0.6s var(--apple-ease); box-shadow: 0 0 15px var(--accent); }
        .card.active::after { transform: scaleY(1); }
        .meta h4 { font-size: 17px; font-weight: 400; color: #666; transition: 0.6s var(--apple-ease); }
        .card.active h4 { color: #fff; letter-spacing: 0.5px; }
        .meta p { font-size: 10px; color: #2a2a2a; margin-top: 6px; }
        .card.active p { color: #555; }
    </style>
</head>
<body>

    <div class="player-frame">
        <div class="player-stage" id="stage">
            <video id="v" playsinline></video>
            
            <div class="loading-overlay" id="loading-overlay">
                <div class="loading-text">资源加载中，请稍候</div>
                <button class="force-play-btn" id="force-play-btn">立即播放</button>
            </div>

            <div class="stage-overlay">
                <div style="display:flex; gap:5px;"><div class="pause-line"></div><div class="pause-line"></div></div>
            </div>
            <button class="fs-trigger" id="fs-btn">全屏播放</button>
        </div>
    </div>

    <div class="action-bar">
        <h2>媒体资产</h2>
        <button class="imm-btn" id="imm-btn">进入沉浸模式</button>
    </div>

    <div class="scroller" id="media-list"></div>

    <script>
        const CONFIG = [
            { title: "陈卓航", desc: "偶然间拍到的照片", url: "1.mp4" },
        ];

        const video = document.getElementById('v');
        const stage = document.getElementById('stage');
        const immBtn = document.getElementById('imm-btn');
        const fsBtn = document.getElementById('fs-btn');
        const forceBtn = document.getElementById('force-play-btn');
        
        let fsTimer = null;
        let waitTimer = null;

        function init() {
            const list = document.getElementById('media-list');
            CONFIG.forEach((item, i) => {
                const card = document.createElement('div');
                card.className = `card ${i === 0 ? 'active' : ''}`;
                card.innerHTML = `<div class="meta"><h4>${item.title}</h4><p>${item.desc}</p></div>`;
                card.onclick = () => loadVideo(i);
                list.appendChild(card);
            });
            loadVideo(0, false, true); 
        }

        function showFsBtn() {
            clearTimeout(fsTimer);
            fsBtn.classList.add('fs-visible');
            if (!video.paused) {
                fsTimer = setTimeout(() => fsBtn.classList.remove('fs-visible'), 2000);
            }
        }

        function loadVideo(i, auto = true, isInitial = false) {
            const cards = document.querySelectorAll('.card');
            cards.forEach((c, idx) => c.classList.toggle('active', idx === i));
            
            // 开启加载状态逻辑
            stage.classList.add('is-loading');
            forceBtn.classList.remove('visible');
            clearTimeout(waitTimer);

            // 启动5秒计时器：显示“立即播放”
            waitTimer = setTimeout(() => {
                if(stage.classList.contains('is-loading')) {
                    forceBtn.classList.add('visible');
                }
            }, 5000);
            
            video.src = CONFIG[i].url;
            video.load();

            // 精准加载判断：HAVE_ENOUGH_DATA 表示足以流畅播放
            video.oncanplaythrough = () => {
                stage.classList.remove('is-loading');
                clearTimeout(waitTimer);
                if(auto) video.play();
                if(!isInitial) showFsBtn();
            };

            video.onwaiting = () => stage.classList.add('is-loading');
            video.onplaying = () => stage.classList.remove('is-loading');
        }

        // “立即播放”强行启动逻辑
        forceBtn.onclick = (e) => {
            e.stopPropagation();
            stage.classList.remove('is-loading');
            clearTimeout(waitTimer);
            video.play().catch(err => console.log("等待更多缓冲中..."));
            showFsBtn();
        };

        stage.onclick = (e) => {
            if (e.target.id === 'fs-btn' || stage.classList.contains('is-loading')) return;
            if (video.paused) { 
                video.play(); stage.classList.remove('video-paused'); showFsBtn();
            } else { 
                video.pause(); stage.classList.add('video-paused'); showFsBtn();
            }
        };

        fsBtn.onclick = (e) => {
            e.stopPropagation();
            if (video.requestFullscreen) video.requestFullscreen();
            else if (video.webkitRequestFullscreen) video.webkitRequestFullscreen();
        };

        immBtn.onclick = async () => {
            if (!document.fullscreenElement) await document.documentElement.requestFullscreen();
            else document.exitFullscreen();
        };

        document.addEventListener('fullscreenchange', () => {
            const isFull = !!document.fullscreenElement;
            if (document.fullscreenElement === document.documentElement || !isFull) {
                document.body.classList.toggle('is-immersive', isFull);
                immBtn.innerText = isFull ? "退出沉浸模式" : "进入沉浸模式";
                immBtn.classList.toggle('active', isFull);
            }
        });

        init();
    </script>
</body>
</html>
