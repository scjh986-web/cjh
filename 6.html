<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>陕西时间 · 交互版</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;400;700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/suncalc@1.9.0/suncalc.min.js"></script>
  <style>
    :root {
      --apple-ease: cubic-bezier(0.23, 1, 0.32, 1);
      --glass-blur: blur(60px);
    }

    * { 
      margin: 0; padding: 0; box-sizing: border-box; 
      -webkit-font-smoothing: antialiased;
      -webkit-touch-callout: none;
    }

    body, html {
      height: 100vh; width: 100vw; overflow: hidden;
      font-family: 'Inter', -apple-system, "SF Pro SC", "HanHei SC", "PingFang SC", sans-serif;
      transition: background 2s var(--apple-ease);
      user-select: none; -webkit-user-select: none;
      touch-action: none;
    }

    .day-mode { background: #FBFBFF; color: #1D1D1F; }
    .night-mode { background: #010101; color: #FFFFFF; }

    @keyframes ambient-pulse {
      0% { transform: translate(0, 0) scale(1); opacity: 0.6; }
      50% { transform: translate(-3%, 2%) scale(1.1); opacity: 0.8; }
      100% { transform: translate(0, 0) scale(1); opacity: 0.6; }
    }

    .ambient-glow {
      position: absolute; width: 140vw; height: 140vh;
      top: -20%; left: -20%; z-index: 1;
      background: radial-gradient(circle at 20% 30%, rgba(0, 122, 255, 0.15) 0%, transparent 50%),
                  radial-gradient(circle at 80% 70%, rgba(255, 45, 85, 0.1) 0%, transparent 50%);
      animation: ambient-pulse 15s infinite alternate ease-in-out;
      pointer-events: none;
    }

    .stage {
      position: relative; z-index: 10;
      width: 100vw; height: 100vh;
      display: flex; align-items: center; justify-content: center;
      perspective: 2000px;
    }

    .kinetic-panel {
      width: 75vw; height: 70vh; max-width: 1440px;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      border-radius: 80px;
      backdrop-filter: var(--glass-blur) saturate(180%);
      -webkit-backdrop-filter: var(--glass-blur) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: transform 0.25s ease-out, background 1s var(--apple-ease);
      box-shadow: 0 40px 120px rgba(0,0,0,0.06), inset 0 0 0 1px rgba(255,255,255,0.1);
      will-change: transform;
    }

    .day-mode .kinetic-panel { background: rgba(255, 255, 255, 0.4); }
    .night-mode .kinetic-panel { 
        background: rgba(25, 25, 27, 0.5); 
        border-color: rgba(255, 255, 255, 0.08); 
        box-shadow: 0 60px 150px rgba(0,0,0,0.4); 
    }

    .time-box { display: flex; align-items: baseline; gap: 1vw; }

    .digit {
      font-size: clamp(4rem, 20vw, 24rem);
      font-weight: 900; line-height: 0.8; letter-spacing: -0.06em;
      font-variant-numeric: tabular-nums;
    }

    .sec-wrap { margin-left: 1.5vw; }
    .sec-digit { font-size: clamp(2rem, 8vw, 10rem); font-weight: 100; opacity: 0.4; }

    .meta-box { margin-top: 6vh; text-align: center; }
    .loc-text { font-size: clamp(14px, 2vw, 28px); font-weight: 700; letter-spacing: 0.4em; margin-bottom: 12px; opacity: 0.8; }
    .date-text { font-size: clamp(12px, 1.2vw, 16px); opacity: 0.4; letter-spacing: 0.1em; }

    @media (max-aspect-ratio: 1/1) {
      .kinetic-panel { width: 92vw; height: 60vh; border-radius: 50px; }
      .time-box { flex-direction: column; align-items: center; gap: 2vh; }
      .sec-wrap { margin-left: 0; text-align: center; }
      .digit { font-size: 26vw; }
      .sec-digit { font-size: 14vw; }
    }

    .idle-cursor { cursor: none; }
  </style>
</head>
<body class="day-mode">

  <div class="ambient-glow"></div>

  <div class="stage" id="mainStage">
    <div class="kinetic-panel" id="tiltPanel">
      <div style="font-size: 10px; font-weight: 700; letter-spacing: 0.6em; opacity: 0.2; margin-bottom: 4vh;">
        时空之轮 · 标准
      </div>

      <div class="time-box">
        <div class="digit" id="hour">00</div>
        <div style="font-size: clamp(2rem, 15vw, 18rem); font-weight: 100; opacity: 0.1;">:</div>
        <div class="digit" id="min">00</div>
        <div class="sec-wrap">
          <div class="sec-digit" id="sec">00</div>
          <div style="font-size: 10px; font-weight: 700; opacity: 0.3; margin-top: 5px;">秒</div>
        </div>
      </div>

      <div class="meta-box">
        <div class="loc-text" id="locDisplay">中国 · 陕西</div>
        <div class="date-text" id="date">2024年1月1日</div>
      </div>
    </div>
  </div>

  <script>
    const hourEl = document.getElementById('hour');
    const minEl = document.getElementById('min');
    const secEl = document.getElementById('sec');
    const dateEl = document.getElementById('date');
    const panel = document.getElementById('tiltPanel');
    const body = document.body;

    let userLoc = { lat: 34.2658, lng: 108.9541 };
    let lastDateStr = "";

    // 1. 地理位置
    if ("geolocation" in navigator) {
      navigator.geolocation.getCurrentPosition(pos => {
        userLoc.lat = pos.coords.latitude;
        userLoc.lng = pos.coords.longitude;
        document.getElementById('locDisplay').innerText = "本地精准定位";
        updateMode();
      });
    }

    // 2. 时间与性能优化
    function update() {
      const now = new Date();
      secEl.innerText = now.getSeconds().toString().padStart(2, '0');
      const m = now.getMinutes().toString().padStart(2, '0');
      const h = now.getHours().toString().padStart(2, '0');
      if (minEl.innerText !== m) minEl.innerText = m;
      if (hourEl.innerText !== h) hourEl.innerText = h;

      const dateStr = now.toDateString();
      if (dateStr !== lastDateStr) {
        const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
        // 渲染为中文日期格式
        dateEl.innerText = now.toLocaleDateString('zh-CN', options);
        updateMode();
        lastDateStr = dateStr;
      }
    }

    function updateMode() {
      const now = new Date();
      const times = SunCalc.getTimes(now, userLoc.lat, userLoc.lng);
      const isDay = now > times.sunrise && now < times.sunset;
      body.className = isDay ? 'day-mode' : 'night-mode';
    }

    // 3. 视差校准逻辑
    let baseBeta = null;
    let baseGamma = null;

    if (window.DeviceOrientationEvent) {
      window.addEventListener('deviceorientation', (e) => {
        if (baseBeta === null && e.beta !== null) {
          baseBeta = e.beta;
          baseGamma = e.gamma;
        }
        const deltaBeta = e.beta - baseBeta;
        const deltaGamma = e.gamma - baseGamma;
        const tiltX = Math.max(Math.min(deltaBeta / 1.2, 30), -30); 
        const tiltY = Math.max(Math.min(deltaGamma / 1.2, 30), -30);
        panel.style.transform = `rotateX(${tiltX}deg) rotateY(${tiltY}deg)`;
      });
    }

    document.addEventListener('mousemove', (e) => {
      if (baseBeta === null) {
        const xAxis = (window.innerWidth / 2 - e.pageX) / 30;
        const yAxis = (window.innerHeight / 2 - e.pageY) / 30;
        panel.style.transform = `rotateY(${xAxis}deg) rotateX(${yAxis}deg)`;
      }
    });

    update();
    setInterval(update, 1000);

    document.getElementById('mainStage').addEventListener('dblclick', () => {
      if (!document.fullscreenElement) document.documentElement.requestFullscreen();
      else document.exitFullscreen();
    });
  </script>
</body>
</html>
